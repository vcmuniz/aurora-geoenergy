<div class="approvals-container">
  <h1>Aprovações</h1>

  <div class="filter-buttons">
    <button 
      [class.active]="selectedFilter === 'pendentes'"
      (click)="setFilter('pendentes')"
      class="filter-btn">
      ⏳ Pendentes
    </button>
    <button 
      [class.active]="selectedFilter === 'aprovados'"
      (click)="setFilter('aprovados')"
      class="filter-btn">
      ✓ Aprovados
    </button>
    <button 
      [class.active]="selectedFilter === 'rejeitados'"
      (click)="setFilter('rejeitados')"
      class="filter-btn">
      ✗ Rejeitados
    </button>
  </div>

  <div *ngIf="loading" class="loading">Carregando...</div>

  <div *ngIf="!loading && displayedApprovals.length > 0">
    <table class="table">
      <thead>
        <tr>
          <th>Aplicação</th>
          <th>Release</th>
          <th>Ambiente</th>
          <th>Score</th>
          <th>Criada em</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let approval of displayedApprovals">
          <td><strong>{{ approval.release.applicationName || 'Unknown' }}</strong></td>
          <td>{{ getReleaseVersion(approval.release) }}</td>
          <td>{{ approval.release.env }}</td>
          <td>
            <div class="score-badge">
              <strong>{{ approval.release.evidenceScore || 0 }}%</strong>
              <div class="score-bar">
                <div class="score-fill" [style.width.%]="approval.release.evidenceScore || 0"></div>
              </div>
            </div>
          </td>
          <td>{{ approval.release.createdAt | date: 'dd/MM/yyyy HH:mm' }}</td>
          <td>
            <button 
              *ngIf="selectedFilter === 'pendentes' && canApprove"
              (click)="openApprovalModal(approval, 'approve')"
              class="btn-icon"
              title="Aprovar">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
            </button>
            <button 
              *ngIf="selectedFilter === 'pendentes' && canReject"
              (click)="openApprovalModal(approval, 'reject')"
              class="btn-icon btn-icon-danger"
              title="Rejeitar">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
            <span *ngIf="selectedFilter !== 'pendentes'" class="status-done">✓ Respondido</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!loading && displayedApprovals.length === 0" class="empty">
    Nenhuma aprovação nesta categoria
  </div>

  <div class="pagination">
    <div class="pagination-info">
      <button (click)="previousPage()" [disabled]="!canPrevious" class="btn-nav">← Anterior</button>
      <span class="page-info">Página {{ (selectedFilter === 'pendentes' ? skipPending : selectedFilter === 'aprovados' ? skipApproved : skipRejected) / (selectedFilter === 'pendentes' ? limitPending : selectedFilter === 'aprovados' ? limitApproved : limitRejected) + 1 }} de {{ Math.ceil((selectedFilter === 'pendentes' ? totalPending : selectedFilter === 'aprovados' ? totalApproved : totalRejected) / (selectedFilter === 'pendentes' ? limitPending : selectedFilter === 'aprovados' ? limitApproved : limitRejected)) }}</span>
      <button (click)="nextPage()" [disabled]="!canNext" class="btn-nav">Próxima →</button>
    </div>
    <div class="items-per-page">
      <label>Itens por página:</label>
      <select [ngModel]="selectedFilter === 'pendentes' ? limitPending : selectedFilter === 'aprovados' ? limitApproved : limitRejected" 
              (change)="onLimitSelectChange($event)"
              [ngModelOptions]="{updateOn: 'change'}" class="select-limit">
        <option [value]="5">5</option>
        <option [value]="10">10</option>
        <option [value]="20">20</option>
      </select>
    </div>
  </div>

  <!-- Modal para Aprovar/Rejeitar -->
  <div *ngIf="showModal" class="modal">
    <div class="modal-content">
      <h2>{{ modalMode === 'approve' ? '✓ Aprovar' : '✗ Rejeitar' }} Lançamento</h2>
      <form (ngSubmit)="submitApproval()">
        <div class="form-group">
          <label>Comentários e Notas *</label>
          <textarea 
            [(ngModel)]="formData.notes" 
            name="notes" 
            placeholder="Descreva o motivo da sua decisão, feedback, ou observações importantes..."></textarea>
          <small class="form-hint">
            {{ formData.notes.length || 0 }} caracteres
            <span *ngIf="formData.notes.length > 0" class="hint-success">✓</span>
          </small>
        </div>
        <div class="modal-actions">
          <button type="button" (click)="closeModal()" class="btn-cancel">Cancelar</button>
          <button 
            type="submit" 
            [class]="modalMode === 'approve' ? 'btn-save' : 'btn-reject'">
            {{ modalMode === 'approve' ? '✓ Aprovar' : '✗ Rejeitar' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
