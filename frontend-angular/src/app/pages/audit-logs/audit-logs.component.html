<div class="audit-container">
  <h1>üìã Auditoria</h1>

  <div class="filters">
  </div>

  <div *ngIf="loading" class="loading">Carregando...</div>

  <div *ngIf="!loading && auditLogs.length > 0">
    <table class="table">
      <thead>
        <tr>
          <th>A√ß√£o</th>
          <th>Descri√ß√£o</th>
          <th>Aplica√ß√£o</th>
          <th>Usu√°rio</th>
          <th>Data e Hora</th>
          <th>Detalhes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let log of auditLogs">
          <td>
            <span [class]="'action-badge action-' + getActionColor(log.action)">
              {{ getActionLabel(log.action) }}
            </span>
          </td>
          <td>
            <strong>{{ getActionDescription(log) }}</strong>
          </td>
          <td>{{ log.payload?.application_name || '-' }}</td>
          <td>{{ log.actor }}</td>
          <td>{{ log.createdAt | date: 'short' }}</td>
          <td>
            <button (click)="openDetailsModal(log)" class="btn-details">Detalhes</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="pagination">
      <div class="pagination-info">
        <button (click)="previousPage()" [disabled]="!canPrevious" class="btn-nav">‚Üê Anterior</button>
        <span class="page-info">P√°gina {{ (skip / limit) + 1 }} de {{ Math.ceil(total / limit) }}</span>
        <button (click)="nextPage()" [disabled]="!canNext" class="btn-nav">Pr√≥xima ‚Üí</button>
      </div>
      <div class="items-per-page">
        <label>Itens por p√°gina:</label>
        <select [(ngModel)]="limit" (change)="onLimitChange()" [ngModelOptions]="{updateOn: 'change'}" class="select-limit">
          <option [value]="5">5</option>
          <option [value]="10">10</option>
          <option [value]="20">20</option>
        </select>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && auditLogs.length === 0" class="empty">
    Nenhuma auditoria registrada
  </div>

  <!-- Details Modal -->
  <div *ngIf="showDetailsModal && selectedLog" class="modal" (click)="closeDetailsModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2>üìã Detalhes da Auditoria</h2>
      <button (click)="closeDetailsModal()" class="btn-close" title="Fechar">‚úï</button>
      
      <div class="details-summary">
        <div class="summary-item">
          <span class="summary-label">O que aconteceu:</span>
          <span class="summary-text">{{ getActionDescription(selectedLog) }}</span>
        </div>
        <div class="summary-item" *ngIf="selectedLog.payload?.application_name">
          <span class="summary-label">Aplica√ß√£o:</span>
          <span class="summary-version">{{ selectedLog.payload.application_name }}</span>
        </div>
        <div class="summary-item" *ngIf="selectedLog.payload?.version">
          <span class="summary-label">Vers√£o:</span>
          <span class="summary-version">v{{ selectedLog.payload.version }}</span>
        </div>
        <div class="summary-item" *ngIf="selectedLog.payload?.environment">
          <span class="summary-label">Ambiente:</span>
          <span class="summary-env">{{ selectedLog.payload.environment }}</span>
        </div>
        <div class="summary-item" *ngIf="selectedLog.payload?.from_env && selectedLog.payload?.to_env">
          <span class="summary-label">Promo√ß√£o:</span>
          <span class="summary-env">{{ selectedLog.payload.from_env }} ‚Üí {{ selectedLog.payload.to_env }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Quem fez:</span>
          <span class="summary-email">{{ selectedLog.actor }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Quando:</span>
          <span class="summary-text">{{ selectedLog.createdAt | date: 'medium' }}</span>
        </div>
      </div>

      <hr />

      <div class="details-grid">
        <div class="detail-item">
          <label>Tipo de A√ß√£o:</label>
          <span [class]="'action-badge action-' + getActionColor(selectedLog.action)">
            {{ getActionLabel(selectedLog.action) }}
          </span>
        </div>
        <div class="detail-item">
          <label>Recurso Afetado:</label>
          <strong>{{ selectedLog.entity }}</strong>
        </div>
        <div class="detail-item full-width">
          <label>ID do Log:</label>
          <code>{{ selectedLog.id }}</code>
        </div>
        <div class="detail-item full-width">
          <label>ID do Recurso:</label>
          <code>{{ selectedLog.entityId }}</code>
        </div>
        <div class="detail-item full-width" *ngIf="selectedLog.requestId">
          <label>Request ID:</label>
          <code>{{ selectedLog.requestId }}</code>
        </div>
        <div class="detail-item full-width" *ngIf="selectedLog.payload">
          <label>üìä Dados Adicionais:</label>
          <pre><code>{{ selectedLog.payload | json }}</code></pre>
        </div>
      </div>

      <div class="modal-actions">
        <button (click)="closeDetailsModal()" class="btn-cancel">Fechar</button>
      </div>
    </div>
  </div>
</div>
